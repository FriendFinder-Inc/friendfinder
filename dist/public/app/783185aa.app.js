"use strict";angular.module("friendfinderApp",["ngCookies","ngResource","ngSanitize","ui.router"]).config(["$stateProvider","$urlRouterProvider","$locationProvider","$httpProvider",function(a,b,c,d){b.otherwise("/"),c.html5Mode(!0),d.interceptors.push("authInterceptor")}]).factory("authInterceptor",["$rootScope","$q","$cookieStore","$location",function(a,b,c,d){return{request:function(a){return a.headers=a.headers||{},c.get("token")&&(a.headers.Authorization="Bearer "+c.get("token")),a},responseError:function(a){return 401===a.status?(d.path("/login"),c.remove("token"),b.reject(a)):b.reject(a)}}}]).run(["$rootScope","$location","Auth",function(a,b,c){a.$on("$stateChangeStart",function(a,d){c.isLoggedInAsync(function(a){d.authenticate&&!a&&b.path("/login")})})}]),angular.module("friendfinderApp").config(["$stateProvider",function(a){a.state("login",{url:"/login",templateUrl:"app/account/login/login.html",controller:"LoginCtrl"}).state("signup",{url:"/signup",templateUrl:"app/account/signup/signup.html",controller:"SignupCtrl"}).state("settings",{url:"/settings",templateUrl:"app/account/settings/settings.html",controller:"SettingsCtrl",authenticate:!0})}]),angular.module("friendfinderApp").controller("SettingsCtrl",["$scope","User","Auth",function(a,b,c){a.errors={},a.changePassword=function(b){a.submitted=!0,b.$valid&&c.changePassword(a.user.oldPassword,a.user.newPassword).then(function(){a.message="Password successfully changed."})["catch"](function(){b.password.$setValidity("mongoose",!1),a.errors.other="Incorrect password",a.message=""})}}]),angular.module("friendfinderApp").controller("AdminCtrl",["$scope","$http","Auth","User",function(a,b,c,d){a.users=d.query(),a["delete"]=function(b){d.remove({id:b._id}),angular.forEach(a.users,function(c,d){c===b&&a.users.splice(d,1)})}}]),angular.module("friendfinderApp").config(["$stateProvider",function(a){a.state("admin",{url:"/admin",templateUrl:"app/admin/admin.html",controller:"AdminCtrl"})}]),angular.module("friendfinderApp").controller("FindFriendsCtrl",["$scope","$http","Auth","User",function(a,b,c,d){a.find=function(){a.evenUsers=[],a.oddUsers=[],d.find({test:"filter"},function(b){angular.forEach(b,function(b,c){c%2?a.evenUsers.push(b):a.oddUsers.push(b)})})},a.find()}]),angular.module("friendfinderApp").config(["$stateProvider",function(a){a.state("findfriends",{url:"/findfriends",templateUrl:"app/findfriends/findfriends.html",controller:"FindFriendsCtrl"})}]),angular.module("friendfinderApp").controller("MainCtrl",["$scope","$http","$window",function(a,b,c){a.loginOauth=function(){c.location.href="/auth/facebook"}}]),angular.module("friendfinderApp").config(["$stateProvider",function(a){a.state("main",{url:"/",templateUrl:"app/main/main.html",controller:"MainCtrl"})}]),angular.module("friendfinderApp").factory("Auth",["$location","$rootScope","$http","User","$cookieStore","$q",function(a,b,c,d,e,f){var g={};return e.get("token")&&(g=d.get()),{login:function(a,b){var h=b||angular.noop,i=f.defer();return c.post("/auth/local",{email:a.email,password:a.password}).success(function(a){return e.put("token",a.token),g=d.get(),i.resolve(a),h()}).error(function(a){return this.logout(),i.reject(a),h(a)}.bind(this)),i.promise},logout:function(){e.remove("token"),g={}},createUser:function(a,b){var c=b||angular.noop;return d.save(a,function(b){return e.put("token",b.token),g=d.get(),c(a)},function(a){return this.logout(),c(a)}.bind(this)).$promise},changePassword:function(a,b,c){var e=c||angular.noop;return d.changePassword({id:g._id},{oldPassword:a,newPassword:b},function(a){return e(a)},function(a){return e(a)}).$promise},getCurrentUser:function(){return g},isLoggedIn:function(){return g.hasOwnProperty("role")},isLoggedInAsync:function(a){g.hasOwnProperty("$promise")?g.$promise.then(function(){a(!0)})["catch"](function(){a(!1)}):a(g.hasOwnProperty("role")?!0:!1)},isAdmin:function(){return"admin"===g.role},getToken:function(){return e.get("token")}}}]),angular.module("friendfinderApp").factory("User",["$resource",function(a){return a("/api/users/:id/:controller",{id:"@rid"},{changePassword:{method:"PUT",params:{controller:"password"}},get:{method:"GET",params:{id:"me"}},find:{method:"GET",isArray:!0,params:{id:"me",controller:"find"}}})}]),angular.module("friendfinderApp").controller("NavbarCtrl",["$scope","$location","Auth",function(a,b,c){a.isCollapsed=!0,a.isLoggedIn=c.isLoggedIn,a.isAdmin=c.isAdmin,a.getCurrentUser=c.getCurrentUser,a.logout=function(){c.logout(),b.path("/login")},$(document).ready(function(){$(".right.menu.open").on("click",function(a){a.preventDefault(),$(".ui.vertical.menu").toggle()}),$(".ui.dropdown").dropdown()}),a.isActive=function(a){return a===b.path()}}]),angular.module("friendfinderApp").run(["$templateCache",function(a){a.put("app/account/settings/settings.html",'<div ng-include="\'components/navbar/navbar.html\'"></div><div class=container><div class=row><div class=col-sm-12><h1>Change Password</h1></div><div class=col-sm-12><form class=form name=form ng-submit=changePassword(form) novalidate><div class=form-group><label>Current Password</label><input type=password name=password class=form-control ng-model=user.oldPassword mongoose-error><p class=help-block ng-show=form.password.$error.mongoose>{{ errors.other }}</p></div><div class=form-group><label>New Password</label><input type=password name=newPassword class=form-control ng-model=user.newPassword ng-minlength=3 required><p class=help-block ng-show="(form.newPassword.$error.minlength || form.newPassword.$error.required) && (form.newPassword.$dirty || submitted)">Password must be at least 3 characters.</p></div><p class=help-block>{{ message }}</p><button class="btn btn-lg btn-primary" type=submit>Save changes</button></form></div></div></div>'),a.put("app/admin/admin.html",'<div ng-include="\'components/navbar/navbar.html\'"></div><div class=container><p>The delete user and user index api routes are restricted to users with the \'admin\' role.</p><ul class=list-group><li class=list-group-item ng-repeat="user in users"><strong>{{user.name}}</strong><br><span class=text-muted>{{user.email}}</span> <a ng-click=delete(user) class=trash><span class="glyphicon glyphicon-trash pull-right"></span></a></li></ul></div>'),a.put("app/findfriends/findfriends.html",'<div ng-include="\'components/navbar/navbar.html\'"></div><div class="ui stackable four column grid"><!-- left side  --><div class="four wide column"><div class="ui styled fluid accordion">filters<div class="active title"><i class="dropdown icon"></i> gender: male</div><div class="active content"><p>there will be options to choose from here soon...</p></div><div class="active title"><i class="dropdown icon"></i> distance</div></div><button class="fluid ui blue button" ng-click=find()>find</button></div><!-- right side --><div class="twelve wide column"><div class="ui grid"><div class="doubling two column row"><div class=column><div class="ui items"><!-- item1 --><div class=item style="max-height: 100px" ng-repeat="user in oddUsers"><div class=image><img ng-src="https://graph.facebook.com/{{ user.facebook.id }}/picture?width=500&height=500&"></div><div class=content><a class=header>{{ user.name }}</a><div class=meta><span class=cinema>{{ user.facebook.location.name }}</span></div><div class=extra><div class="ui horizontal label">more</div><div class="ui horizontal label"><i class="globe icon"></i>info here</div></div><div class=description>This will eventually be a quick little introduction paragraph the users will create...</div></div></div></div></div><div class=column><div class="ui items"><!-- item2 --><div class=item style="max-height: 100px" ng-repeat="user in evenUsers"><div class=image><img ng-src="https://graph.facebook.com/{{ user.facebook.id }}/picture?width=500&height=500&"></div><div class=content><a class=header>{{ user.name }}</a><div class=meta><span class=cinema>{{ user.facebook.location.name }}</span></div><div class=extra><div class="ui horizontal label">icon</div><div class="ui horizontal label"><i class="globe icon"></i>icon2</div></div><div class=description>placeholder</div></div></div></div></div></div></div></div></div>'),a.put("app/main/main.html",'<div style="text-align: center; margin-top:10%"><div class="circular ui icon blue large button blue-glow" ng-click=loginOauth()><i class="icon large facebook"></i></div></div>'),a.put("components/directives/profile-card/profile-card.html",""),a.put("components/navbar/navbar.html",'<div class="ui page grid" ng-controller=NavbarCtrl><div class="computer tablet only row"><div class="ui inverted menu navbar"><a href="" class="brand item">friendfinder</a> <a href="" class="active item">find friends</a> <a href="" class=item>find activities</a><div class="right menu"><a class="ui dropdown item">user prefs <i class="dropdown icon"></i><div class=menu><div class=item>settings</div><div class=item>logout</div></div></a></div></div></div><!-- mobile menu --><div class="mobile only narrow row"><div class="ui inverted navbar menu"><a href="" class="brand item">friendfinder</a> <a href="" class="brand item">filters</a><div class="right menu open"><a href="" class="menu item"><i class="reorder icon"></i></a></div></div><div class="ui vertical navbar menu"><a href="" class="active item">find friends</a> <a href="" class=item>find activities</a><div class="ui item"><div class=text>Dropdown</div><div class=menu><a class=item>Action</a> <a class=item>Another action</a> <a class=item>Something else here</a> <a class="ui aider"></a> <a class=item>Seperated link</a> <a class=item>One more seperated link</a></div></div></div></div></div>')}]);